# 短链接分库分表
## application.yaml

```yaml
server:
  port: 8001

spring:
  datasource:
    driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver
    url: jdbc:shardingsphere:classpath:shardingsphere-config.yaml
  data:
    redis:
      host: 118.31.71.211
      port: 6379
      password: 171612cgj
```

## `shardingsphere-config.yaml`

```yaml
dataSources:
  ds_0:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    jdbcUrl: jdbc:mysql://118.31.71.211:3306/link?useUnicode=true&characterEncoding=UTF-8&rewriteBatchedStatements=true&allowMultiQueries=true&serverTimezone=Asia/Shanghai
    username: chenguangjie
    password: 171612cgjA

# 分片规则配置
rules:
  - !SHARDING
    tables:
      # 目标分片表名称
      t_link:
        # 真实表节点表达式，创建16个分表（t_user_0到t_user_15）
        actualDataNodes: ds_0.t_link_${0..15}
        # 分表策略
        tableStrategy:
          # 标准分片策略
          standard:
            # 分片键字段名
            shardingColumn: gid
            # 分片算法名称
            shardingAlgorithmName: link_table_hash_mod
    # 分片算法定义
    shardingAlgorithms:
      # 算法名称（与上文对应）
      link_table_hash_mod:
        # 哈希取模算法类型
        type: HASH_MOD
        # 分片总数，对应actualDataNodes的16个分表
        props:
          sharding-count: 16
# 全局属性配置 - 展现逻辑 SQL & 真实 SQL
props:
  sql-show: true
```

根据gid进行分库分表，查询性能 如果使用gid作为分片键,相同gid的所有短链接会存储在同一个分表中。这样在查询某个分组(gid)的所有短链接时,只需要查询对应的那个分表,而不需要扫描所有分表,可以大大提高查询性能。

## 分表之后怎么保证fullShortLink的全局唯一呀？

短链接分表后，虽然设置了短链唯一，但是如果在并发情况下，布隆过滤器也判断该短链不存在，由于分片键是gid，因此有可能出现有短链重复的可能

针对这个问题，已做出优化处理，一句话可以概述，在 goto 表为 full_short_url 加唯一索引。视频地址：https://t.zsxq.com/197q2tkZP